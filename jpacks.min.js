!function(r){function e(){function r(r){var e=this;Object.keys(r).forEach(function(n){e[n]=r[n]})}function e(r){c=r}function n(r){if(r instanceof ArrayBuffer)return r;var e=new ArrayBuffer(r.length),n=new Uint8Array(e,0,r.length);return n.set(r),e}function t(e,t,a,i){var o=r.from(e);if(!o)throw new Error('Parameter schema "'+e+'" is unregister.');return t=n(t),a=a||{},i=i||[0],"undefined"==typeof a.littleEndian&&(a.littleEndian=c),o.unpack(t,a,i)}function a(e,n,t,a){var i=r.from(e);if(!i)throw new Error('Parameter schema "'+e+'" is unregister.');return a=a||[],t=t||{},"undefined"==typeof t.littleEndian&&(t.littleEndian=c),i.pack(n,t,a),a}function i(r,e,n){if(r.length<=0)return r;var t=function(){var t=[];if([].push.apply(t,n),[].push.apply(t,arguments),t.length>=r.length)return r.apply(null,t);var a=i(r,e,t);return"function"==typeof e&&e(a,t),a};return t}function o(e){function n(e){if(!e)return e;if(e.namespace)return"number"===e.namespace?e.name:e.args?e.namespace+"("+o.apply(null,e.args)+")":e.namespace;if(e.name)return e.name;if("function"==typeof e)return e.name="_pack_fn"+s++,r.define(e.name,e),e.name;if("object"==typeof e){var t=new e.constructor;return Object.keys(e).forEach(function(r){t[r]=n(e[r])}),t}return e}if(arguments.length>1){for(var t=[],a=0;a<arguments.length;a++)t.push(o(arguments[a]));return t.join()}return JSON.stringify(n(e)||"").replace(/"/g,"")}var u={};r.register=function(e,n){if("undefined"==typeof e)throw new Error('Parameter "name" is undefined.');u[e]=n,r[e]||(r[e]=n)};var f=[function(r){for(var e={},n=r;"string"==typeof n;){if(e[n])return;n=u[n],e[n]=!0}return n}];r.pushPattern=function(r){"function"==typeof r&&f.push(r)},r.from=function(e){if("undefined"!=typeof e){if(e instanceof r)return e;for(var n=-1,t=0;t<f.length;t++)if(n!==t){var a=f[t](e);if(a){if(a instanceof r)return a;e=a,n=t,t=0}}}};var c;r.setDefaultLittleEndian=e,r.arrayBufferFrom=n,r.unpack=t,r.pack=a,r.together=i;var s=0;return r.stringify=o,r.prototype.toString=function(){return o(this)},r}function n(){function r(r,e){if("undefined"==typeof r)throw new Error('Parameter "itemSchema" is undefined.');var n,t;if("number"==typeof e)n=r.size*e;else if(t=l.from(e),"number"!==t.namespace)throw new Error('Parameter "count" is not a numeric type.');return new l({unpack:function(a,i,o){var u=e;if(t&&(u=l.unpack(t,a,i,o)),r.array&&i.littleEndian){n=t.size*u;var f=o[0];return o[0]+=n,[].slice.apply(new r.array(a,f,u))}for(var c=[],s=0;u>s;s++)c.push(l.unpack(r,a,i,o));return c},pack:function(a,i,o){var u=e;if(t&&(u=a?a.length:0,l.pack(t,u,i,o)),r.array&&i.littleEndian){n=r.size*u;var f=new ArrayBuffer(n),c=new r.array(f);c.set(a);var s=new Uint8Array(f);[].push.apply(o,s)}for(var p=0;u>p;p++)l.pack(r,a[p],i,o)},namespace:"array",args:arguments,size:n})}function n(r){return v(r,"uint8")}function t(r){return v(r,"uint16")}function a(r){return v(r,"uint32")}function i(r){return l.array("uint8",r)}function o(r){if("object"!=typeof r)throw new Error('Parameter "schemas" must be a object type.');if(r instanceof l)return r;var e=Object.keys(r);return new l({unpack:function(n,t,a){var i=new r.constructor,o=t.$scope;return t.$scope=i,e.forEach(function(e){i[e]=l.unpack(r[e],n,t,a)}),t.$scope=o,i},pack:function(n,t,a){var i=t.$scope;t.$scope=n,e.forEach(function(e){l.pack(r[e],n[e],t,a)}),t.$scope=i},args:arguments,namespace:"object"})}function u(r,e){if("object"!=typeof r)throw new Error('Parameter "schemas" must be a object type.');if(r instanceof l)throw new Error('Parameter "schemas" cannot be a Schema object.');var n=Object.keys(r);return new l({unpack:function(t,a,i){var o=i[0],u={};return n.forEach(function(e){i[0]=o,u[e]=l.unpack(r[e],t,a,i)}),i[0]+=e,u},pack:function(t,a,i){var o=new ArrayBuffer(e),u=new Uint8Array(o);n.forEach(function(e){if("undefined"!=typeof t[e]){var n=[];l.pack(r[e],t[e],a,n),u.set(n)}}),[].push.apply(i,u)},size:e,args:arguments,namespace:"union"})}function f(r,e){if(e=l.from(e),!e)throw new Error('Parameter "baseSchema" is undefined.');if("number"!==e.namespace)throw new Error('Parameter "baseSchema" is not a numeric type.');if("object"!=typeof r)throw new Error('Parameter "map" must be a object type.');if(r instanceof Array){var n={};r.forEach(function(r,e){n[r]=e}),r=n}var t=Object.keys(r);return new l({unpack:function(n,a,i){var o,u=l.unpack(e,n,a,i);return t.every(function(e){return r[e]===u?(o=e,!1):!0}),o||u},pack:function(n,a,i){if("number"==typeof n)return void l.pack(e,n,a,i);if(t.every(function(t){return t===n?(l.pack(e,r[t],a,i),!1):!0}))throw new Error('Not find enum "'+n+'".')},namespace:"enums",args:arguments})}function c(r){return String(r).replace(/[\u0080-\u07ff]/g,function(r){var e=r.charCodeAt(0);return String.fromCharCode(192|e>>6,128|63&e)}).replace(/[\u0800-\uffff]/g,function(r){var e=r.charCodeAt(0);return String.fromCharCode(224|e>>12,128|e>>6&63,128|63&e)})}function s(r){return String(r).replace(/[\u00c0-\u00df][\u0080-\u00bf]/g,function(r){var e=(31&r.charCodeAt(0))<<6|63&r.charCodeAt(1);return String.fromCharCode(e)}).replace(/[\u00e0-\u00ef][\u0080-\u00bf][\u0080-\u00bf]/g,function(r){var e=(15&r.charCodeAt(0))<<12|(63&r.charCodeAt(1))<<6|63&r.charCodeAt(2);return String.fromCharCode(e)})}function p(r,e){return"undefined"!=typeof Buffer?new Buffer(r,e):c(r).split("").map(function(r){return r.charCodeAt()})}function y(r){var e=l.array("uint8",r);return new l({unpack:function(r,n,t){var a=l.unpack(e,r,n,t);return"undefined"!=typeof Buffer?new Buffer(a).toString():s(String.fromCharCode.apply(String,a))},pack:function(r,n,t){l.pack(e,p(r),n,t)},namespace:"string",args:arguments})}function m(r,e){if("object"!=typeof r)throw new Error('Parameter "patterns" must be a object type.');if(r instanceof l)throw new Error('Parameter "patterns" cannot be a Schema object.');if(!(r instanceof Array))throw new Error('Parameter "patterns" must be a array.');if("undefined"==typeof e)throw new Error('Parameter "value" is undefined.');for(var n=0;n<r.length;n++)if(r[n][0]===e)return r[n][1]}function g(r,e){if("string"!=typeof r)throw new Error('Parameter "field" must be a string.');if("function"!=typeof e)throw new Error('Parameter "field" must be a function.');return new l({unpack:function(n,t,a){if(!t.$scope)throw new Error("Unpack must running in object.");var i=t.$scope[r];if("undefined"==typeof i)throw new Error('Field "'+r+'" is undefined.');return l.unpack(e(i),n,t,a)},pack:function(n,t,a){var i=t.$scope[r];if("undefined"==typeof i)throw new Error('Field "'+r+'" is undefined.');l.pack(e(i),n,t,a)},namespace:"depend",args:arguments})}function h(r,e){return S(r,l.array(e))}function d(r,e,n,t){if("function"!=typeof r)throw new Error('Parameter "compress" must be a function.');if("function"!=typeof e)throw new Error('Parameter "decompress" must be a function.');var a=l.bytes(t);return new l({unpack:function(r,t,i){var o=e(l.unpack(a,r,t,i));return l.unpack(n,o,t)},pack:function(e,t,i){var o=r(l.pack(n,e,t));l.pack(a,o,t,i)},namespace:"parse",args:arguments})}var l=e(),w={int8:{type:"Int8",size:1,alias:["shortint"],array:Int8Array},uint8:{type:"Uint8",size:1,alias:["byte"],array:Uint8Array},int16:{type:"Int16",size:2,alias:["smallint"],array:Int16Array},uint16:{type:"Uint16",size:2,alias:["word"],array:Uint16Array},int32:{type:"Int32",size:4,alias:["longint"],array:Int32Array},uint32:{type:"Uint32",size:4,alias:["longword"],array:Uint32Array},float32:{type:"Float32",size:4,alias:["single"],array:Float32Array},float64:{type:"Float64",size:8,alias:["double"],array:Float64Array}};Object.keys(w).forEach(function(r){var e=w[r],n=new l({unpack:function(r){return function(n,t,a){var i=a[0];a[0]+=e.size;var o;return o=n instanceof DataView?n:new DataView(n),o[r](i,t.littleEndian)}}("get"+e.type),pack:function(r){return function(n,t,a){var i=new ArrayBuffer(e.size),o=new DataView(i),u=new Uint8Array(i);o[r](0,n,t.littleEndian),[].push.apply(a,u)}}("set"+e.type),size:e.size,name:r,namespace:"number",array:e.array});l.register(r,n),(e.alias||[]).forEach(function(r){l.register(r,n)})});var v=l.together(r,function(r,e){r.namespace="array",r.args=e});l.register("array",v),l.register("shortArray",n),l.register("smallArray",t),l.register("longArray",a),l.register("bytes",i);var k=l.together(o,function(r,e){r.namespace="object",r.args=e});l.register("object",k),l.pushPattern(function(r){if("object"==typeof r){if(r instanceof l)return;if(r instanceof Array)return;return k(r)}});var b=l.together(u,function(r,e){r.namespace="union",r.args=e});l.register("union",b);var E=l.together(f,function(r,e){r.namespace="enums",r.args=e});l.register("enums",E),l.stringBytes=p;var A=l.together(y,function(r,e){r.namespace="string",r.args=e});l.register("string",A),l.register("shortString",A("uint8")),l.register("smallString",A("uint16")),l.register("longString",A("uint32"));var j=new l({unpack:function(r,e,n){for(var t=new Uint8Array(r,n[0]),a=0;t[a];)a++;var i=l.unpack(l.string(a),r,e,n);return n[0]++,i},pack:function(r,e,n){var t=l.stringBytes(r);l.pack(l.bytes(t.length),t,e,n),l.pack("byte",0,e,n)},namespace:"cstring",schema:"cstring"});l.register("cstring",j),l.register("pchar",j);var P=l.together(m,function(r,e){r.namespace="cases",r.args=e});l.register("cases",P);var S=l.together(g,function(r,e){r.namespace="depend",r.args=e});l.register("depend",S),l.register("dependArray",h);var C=l.together(d,function(r,e){r.namespace="parse",r.args=e});return l.register("parse",C),l}var t=n();t.create=n;var a=t;"function"==typeof define?(define.amd||define.cmd)&&define(function(){return a}):"undefined"!=typeof module&&module.exports?module.exports=a:window[r]=a}("jpacks");