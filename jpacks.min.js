!function(r){function e(r){var e=this;Object.keys(r).forEach(function(n){e[n]=r[n]})}function n(r){j=r}function t(r){if(r instanceof ArrayBuffer)return r;var e=new ArrayBuffer(r.length),n=new Uint8Array(e,0,r.length);return n.set(r),e}function a(r,n,a,i){var o=e.from(r);if(!o)throw new Error('Parameter schema "'+r+'" is unregister.');return n=t(n),a=a||{},i=i||[0],"undefined"==typeof a.littleEndian&&(a.littleEndian=j),o.unpack(n,a,i)}function i(r,n,t,a){var i=e.from(r);if(!i)throw new Error('Parameter schema "'+r+'" is unregister.');return a=a||[],t=t||{},"undefined"==typeof t.littleEndian&&(t.littleEndian=j),i.pack(n,t,a),a}function o(r,n){if("number"!=typeof r){var t=r;r=n,n=t}var a=e.from(n);if(!a)throw new Error('Schema "'+n+'" not define.');var i=a.size*r;return new e({unpack:function(n,t,o){if(a.array&&t.littleEndian){var c=o[0];return o[0]+=i,[].slice.apply(new a.array(n,c,r))}for(var u=[],f=0;r>f;f++)u.push(e.unpack(a,n,t,o));return u},pack:function(n,t,o){if(a.array&&t.littleEndian){var c=new ArrayBuffer(i),u=new a.array(c);u.set(n);var f=new Uint8Array(c);[].push.apply(o,f)}for(var s=0;r>s;s++)e.pack(a,n[s],t,o)},name:a.name+"["+r+"]",size:i,namespace:"array"})}function c(r){return o(r,"uint8")}function u(r,n){if(r=e.from(r),"base"!==r.namespace)throw new Error('Parameter "lengthSchema" is not a numeric type.');if(!n)throw new Error('Parameter "itemSchema" is undefined.');return new e({unpack:function(t,a,i){var o=e.unpack(r,t,a,i);return e.unpack(e.array(o,n),t,a,i)},pack:function(t,a,i){t?(e.pack(r,t.length,a,i),e.pack(e.array(t.length,n),t,a,i)):e.pack(r,0,a,i)},name:"dynamic array[.."+r.name+"..]",namespace:"dynamicArray",size:r.size})}function f(r){return u("uint8",r)}function s(r){return u("uint16",r)}function p(r){return u("uint32",r)}function m(r){if("object"!=typeof r)throw new Error('Parameter "schemas" must be a object type.');return r instanceof e?r:new e({unpack:function(n,t,a){var i={},o=t.$scope;return t.$scope=i,Object.keys(r).forEach(function(o){i[o]=e.unpack(r[o],n,t,a)}),t.$scope=o,i},pack:function(n,t,a){var i=t.$scope;t.$scope=n,Object.keys(r).forEach(function(i){e.pack(r[i],n[i],t,a)}),t.$scope=i},object:r,name:"object {}"})}function y(r,n){if("number"!=typeof r){var t=r;r=n,n=t}if("number"!=typeof r)throw new Error('Parameter "size" must be a numeric type.');if("object"!=typeof n)throw new Error('Parameter "schemas" must be a object type.');if(n instanceof e)throw new Error('Parameter "schemas" cannot be a Schema object.');var a=Object.keys(n);return new e({unpack:function(t,i,o){var c=o[0],u={};return a.forEach(function(r){o[0]=c,u[r]=e.unpack(n[r],t,i,o)}),o[0]+=r,u},pack:function(t,i,o){var c=new ArrayBuffer(r),u=new Uint8Array(c);a.forEach(function(r){var a=[];e.pack(n[r],t[r],i,a),u.set(a)}),[].push.apply(o,u)},size:r,object:n,name:"union {}"})}function g(r){if("object"!=typeof r)throw new Error('Parameter "schemas" must be a object type.');if(r instanceof e)throw new Error('Parameter "schemas" cannot be a Schema object.');var n=Object.keys(r),t=n[0],a=r[t];return n=n.slice(1),new e({unpack:function(i,o,c){var u={},f=e.unpack(a,i,o,c);return u[t]=f,n.every(function(n){return f===r[n][0]?(u[n]=e.unpack(r[n][1],i,o,c),!1):!0}),u},pack:function(i,o,c){var u=i[t];e.pack(a,u,o,c),n.every(function(n){return u===r[n][0]?(e.pack(r[n][1],i[n],o,c),!1):!0})},name:"cases{"+t+"}",namespace:"cases"})}function h(r){return String(r).replace(/[\u0080-\u07ff]/g,function(r){var e=r.charCodeAt(0);return String.fromCharCode(192|e>>6,128|63&e)}).replace(/[\u0800-\uffff]/g,function(r){var e=r.charCodeAt(0);return String.fromCharCode(224|e>>12,128|e>>6&63,128|63&e)})}function w(r){return String(r).replace(/[\u00c0-\u00df][\u0080-\u00bf]/g,function(r){var e=(31&r.charCodeAt(0))<<6|63&r.charCodeAt(1);return String.fromCharCode(e)}).replace(/[\u00e0-\u00ef][\u0080-\u00bf][\u0080-\u00bf]/g,function(r){var e=(15&r.charCodeAt(0))<<12|(63&r.charCodeAt(1))<<6|63&r.charCodeAt(2);return String.fromCharCode(e)})}function d(r,e){return"undefined"!=typeof Buffer?new Buffer(r,e):h(r).split("").map(function(r){return r.charCodeAt()})}function l(r){var n=e.array(r,"uint8");return new e({unpack:function(r,t,a){var i=e.unpack(n,r,t,a);return"undefined"!=typeof Buffer?new Buffer(i).toString():w(String.fromCharCode.apply(String,i))},pack:function(r,t,a){e.pack(n,d(r),t,a)},namespace:"staticString",name:"string{"+r+"}",size:r})}function k(r){if(r=e.from(r),!r)throw new Error('Parameter "lengthSchema" is undefined.');if("base"!==r.namespace)throw new Error('Parameter "lengthSchema" is not a numeric type.');return new e({unpack:function(n,t,a){var i=e.unpack(r,n,t,a);return e.unpack(e.string(i),n,t,a)},pack:function(n,t,a){if(n){var i=e.stringBytes(n);e.pack(r,i.length,t,a),e.pack(e.bytes(i.length),i,t,a)}else e.pack(r,0,t,a)},namespace:"dynamicString",name:"string{.."+r.name+"..}"})}function v(r,n){if("string"!=typeof r)throw new Error('Parameter "field" must be a string.');return new e({unpack:function(t,a,i){if(!a.$scope)throw new Error("Unpack must running in object.");var o=a.$scope[r];if("number"!=typeof o)throw new Error('Field "'+r+'" must be a number.');return e.unpack(e.staticArray(o,n),t,a,i)},pack:function(t,a,i){var o=a.$scope[r];if("number"!=typeof o)throw new Error('Field "'+r+'" must be a number.');e.pack(e.array(o,n),t,a,i)},name:"depend array{"+r+"}",namespace:"dependArray"})}function b(r,n){if("string"!=typeof r)throw new Error('Parameter "field" must be a string.');return new e({unpack:function(t,a,i){if(!a.$scope)throw new Error("Unpack must running in object.");var o=a.$scope[r];if("number"!=typeof o)throw new Error('Field "'+r+'" must be a number.');return e.unpack(e.staticString(o,n),t,a,i)},pack:function(n,t,a){var i=t.$scope[r];if("number"!=typeof i)throw new Error('Field "'+r+'" must be a number.');e.pack(e.string(i),n,t,a)},name:"depend string{"+r+"}",namespace:"dependString"})}function E(r,n){if(r=e.from(r),!r)throw new Error('Parameter "baseSchema" is undefined.');if("base"!==r.namespace)throw new Error('Parameter "baseSchema" is not a numeric type.');if("object"!=typeof n)throw new Error('Parameter "map" must be a object type.');if(n instanceof Array){var t={};n.forEach(function(r,e){t[r]=e}),n=t}var a=Object.keys(n);return new e({unpack:function(t,i,o){var c,u=e.unpack(r,t,i,o);return a.every(function(r){return n[r]===u?(c=r,!1):!0}),c},pack:function(t,i,o){if(a.every(function(a){return a===t?(e.pack(r,n[a],i,o),!1):!0}))throw new Error('Not find enum "'+t+'".')},map:n,name:"enum {}"})}var A={};e.register=function(r,n){if("undefined"==typeof r)throw new Error('Parameter "name" is undefined.');A[r]=n,e[r]||(e[r]=n)};var S=[function(r){for(var e={},n=r;"string"==typeof n;){if(e[n])return;n=A[n],e[n]=!0}return n}];e.pushPattern=function(r){"function"==typeof r&&S.push(r)},e.from=function(r){if("undefined"!=typeof r){if(r instanceof e)return r;for(var n=-1,t=0;t<S.length;t++)if(n!==t){var a=S[t](r);if(a){if(a instanceof e)return a;r=a,n=t,t=0}}}};var j;e.setDefaultLittleEndian=n,e.arrayBufferFrom=t,e.unpack=a,e.pack=i;var P={int8:{type:"Int8",size:1,alias:["shortint"],array:Int8Array},uint8:{type:"Uint8",size:1,alias:["byte"],array:Uint8Array},int16:{type:"Int16",size:2,alias:["smallint"],array:Int16Array},uint16:{type:"Uint16",size:2,alias:["word"],array:Uint16Array},int32:{type:"Int32",size:4,alias:["longint"],array:Int32Array},uint32:{type:"Uint32",size:4,alias:["longword"],array:Uint32Array},float32:{type:"Float32",size:4,alias:["single"],array:Float32Array},float64:{type:"Float64",size:8,alias:["double"],array:Float64Array}};Object.keys(P).forEach(function(r){var n=P[r],t=new e({unpack:function(r){return function(e,t,a){var i=a[0];a[0]+=n.size;var o;return o=e instanceof DataView?e:new DataView(e),o[r](i,t.littleEndian)}}("get"+n.type),pack:function(r){return function(e,t,a){var i=new ArrayBuffer(n.size),o=new DataView(i),c=new Uint8Array(i);o[r](0,e,t.littleEndian),[].push.apply(a,c)}}("set"+n.type),size:n.size,name:r,namespace:"base",array:n.array});e.register(r,t),(n.alias||[]).forEach(function(r){e.register(r,t)})}),e.register("array",o),e.register("staticArray",o),e.register("bytes",c),e.pushPattern(function(r){if("string"==typeof r){var n=r.match(/^(\w+)\[(\d+)\]$/);if(n){var t=e.from(n[1]);if(t){var a=o(parseInt(n[2]),t);return e.register(r,a),a}}}}),e.register("dynamicArray",u),e.register("shortArray",f),e.register("smallArray",s),e.register("longArray",p),e.pushPattern(function(r){if("string"==typeof r){var n=r.match(/^(\w+)\[(\.|\..|\....)\]$/);if(n){var t=e.from(n[1]);if(t){var a="uint16";switch(n[2]){case".":a="uint8";break;case"....":a="uint32"}var i=u(a,t);return e.register(r,i),i}}}}),e.register("object",m),e.pushPattern(function(r){if("object"==typeof r){if(r instanceof e)return;if(r instanceof Array)return;return m(r)}}),e.register("union",y),e.register("cases",g),e.stringBytes=d,e.register("string",l),e.register("staticString",l),e.pushPattern(function(r){if("string"==typeof r){var n=r.match(/^string\{(\d+)\}$/);if(n){var t=l(parseInt(n[1]));return e.register(r,t),t}}}),e.register("dynamicString",k),e.register("shortString",k("uint8")),e.register("smallString",k("uint16")),e.register("longString",k("uint32")),e.register("dependArray",v),e.register("dependString",b),e.register("enums",E);var z=new e({unpack:function(r,n,t){for(var a=new Uint8Array(r,t[0]),i=0;a[i];)i++;var o=e.unpack(e.string(i),r,n,t);return t[0]++,o},pack:function(r,n,t){var a=e.stringBytes(r);e.pack(e.bytes(a.length),a,n,t),e.pack("byte",0,n,t)},namespace:"cstring",name:"cstring"});e.register("cstring",z),e.register("pchar",z);var C=e;"function"==typeof define?(define.amd||define.cmd)&&define(function(){return C}):"undefined"!=typeof module&&module.exports?module.exports=C:window[r]=C}("jpacks");