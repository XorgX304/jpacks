!function(n){function r(){function n(n){n=n||{};var r=this;Object.keys(n).forEach(function(e){r[e]=n[e]})}function r(n){n=n||{},Object.keys(n).forEach(function(r){f[r]=n[r]})}function e(n){if(n instanceof ArrayBuffer)return n;var r=new ArrayBuffer(n.length),e=new Uint8Array(r,0,n.length);return e.set(n),r}function t(r,t,a,i){var u=n.from(r);return t=e(t),a=a||{},i=i||[0],Object.keys(f).forEach(function(n){"undefined"==typeof a[n]&&(a[n]=f[n])}),u.unpack(t,a,i)}function a(r,e,t,a){var i=n.from(r);return a=a||[],t=t||{},Object.keys(f).forEach(function(n){"undefined"==typeof t[n]&&(t[n]=f[n])}),i.pack(e,t,a),a}function i(n,r,e){if(n.length<=0)return n;var t=function(){var t=[];if([].push.apply(t,e),[].push.apply(t,arguments),t.length>=n.length)return n.apply(null,t);var a=i(n,r,t);return"function"==typeof r&&r(a,t),a};return t}function u(r){function e(r){if(null===r)return"null";if(!r)return r;if(r.namespace)return"number"===r.namespace?"'"+r.name+"'":r.args?r.namespace+"("+u.apply(null,r.args)+")":"'"+r.namespace+"'";if("function"==typeof r)r.name||(r.name="_pack_fn"+s++,n.def(r.name,r));else if("object"==typeof r){var t=new r.constructor;return Object.keys(r).forEach(function(n){t[n]=e(r[n])}),t}return r.name?"'"+r.name+"'":"string"==typeof r?"'"+r+"'":r}if(arguments.length>1){for(var t=[],a=0;a<arguments.length;a++)t.push(u(arguments[a]));return t.join()}return JSON.stringify(e(r)||"").replace(/"/g,"")}var o={};n.register=function(r,e){o[r]=e,n[r]||(n[r]=e)},n.def=n.register;var c=[function(n){for(var r={},e=n;"string"==typeof e;){if(r[e])return;e=o[e],r[e]=!0}return e}];n.pushPattern=function(n){c.push(n)},n.from=function(r){if(r instanceof n)return r;for(var e=-1,t=0;t<c.length;t++)if(e!==t){var a=c[t](r);if(a){if(a instanceof n)return a;r=a,e=t,t=0}}};var f={littleEndian:!0};n.setDefaultOptions=r,n.arrayBufferFrom=e,n.unpack=t,n.pack=a,n.together=i;var s=0;return n.stringify=u,n.prototype.toString=function(){return u(this)},n}function e(){function n(n,r){var e;return"number"!==r&&null!==r&&(e=k.from(r)),new k({unpack:function(t,a,i){var u;if(u=e?k.unpack(e,t,a,i):r,0===u)return[];var o=[],c=k.from(n);if(c.array&&(a.littleEndian||1===c.size)){var f=null===u?t.byteLength:c.size*u,s=i[0],p=new ArrayBuffer(f),g=new c.array(p),y=new Uint8Array(p);return y.set(new Uint8Array(t,s,Math.min(f,t.byteLength))),[].push.apply(o,g),i[0]+=f,o}if(null===u)for(var l;i[0]<t.byteLength&&l!==i[0];)l=i[0],o.push(k.unpack(c,t,a,i));else for(var m=0;u>m;m++)o.push(k.unpack(c,t,a,i));return o},pack:function(t,a,i){var u=k.from(n);if(t||e){var o;if(e?(o=t?t.length:0,k.pack(e,o,a,i)):o=null===r?(t||[]).length:r,t&&o){if(u.array&&(a.littleEndian||1===u.size)){var c=u.size*o,f=new ArrayBuffer(c),s=new u.array(f);s.set(t.slice(0,o));var p=new Uint8Array(f);return void[].push.apply(i,p)}for(var g=0;o>g;g++)k.pack(u,(t||[])[g],a,i)}}},namespace:"array",args:arguments,size:"number"===r?itemSchema.size*r:void 0})}function e(n){return b(n,"uint8")}function t(n){return b(n,"uint16")}function a(n){return b(n,"uint32")}function i(n){return k.array("uint8",n)}function u(n){if(n instanceof k)return n;var r=Object.keys(n);return new k({unpack:function(e,t,a){var i=new n.constructor,u=t.$scope;return t.$scope=i,r.forEach(function(r){i[r]=k.unpack(n[r],e,t,a)}),t.$scope=u,i},pack:function(e,t,a){var i=t.$scope;t.$scope=e,r.forEach(function(r){k.pack(n[r],e[r],t,a)}),t.$scope=i},args:arguments,namespace:"object"})}function o(n,r){var e=Object.keys(n);return new k({unpack:function(t,a,i){var u=i[0],o={};return e.forEach(function(r){i[0]=u,o[r]=k.unpack(n[r],t,a,i)}),i[0]+=r,o},pack:function(t,a,i){var u=new ArrayBuffer(r),o=new Uint8Array(u);e.forEach(function(r){if("undefined"!=typeof t[r]){var e=[];k.pack(n[r],t[r],a,e),o.set(e)}}),[].push.apply(i,o)},size:r,args:arguments,namespace:"union"})}function c(n,r){if(r=k.from(r),n instanceof Array){var e={};n.forEach(function(n,r){e[n]=r}),n=e}var t=Object.keys(n);return new k({unpack:function(e,a,i){var u,o=k.unpack(r,e,a,i);return t.every(function(r){return n[r]===o?(u=r,!1):!0}),u||o},pack:function(e,a,i){if("number"==typeof e)return void k.pack(r,e,a,i);if(t.every(function(t){return t===e?(k.pack(r,n[t],a,i),!1):!0}))throw new Error('Not find enum "'+e+'".')},namespace:"enums",args:arguments})}function f(n){return String(n).replace(/[\u0080-\u07ff]/g,function(n){var r=n.charCodeAt(0);return String.fromCharCode(192|r>>6,128|63&r)}).replace(/[\u0800-\uffff]/g,function(n){var r=n.charCodeAt(0);return String.fromCharCode(224|r>>12,128|r>>6&63,128|63&r)})}function s(n){return String(n).replace(/[\u00c0-\u00df][\u0080-\u00bf]/g,function(n){var r=(31&n.charCodeAt(0))<<6|63&n.charCodeAt(1);return String.fromCharCode(r)}).replace(/[\u00e0-\u00ef][\u0080-\u00bf][\u0080-\u00bf]/g,function(n){var r=(15&n.charCodeAt(0))<<12|(63&n.charCodeAt(1))<<6|63&n.charCodeAt(2);return String.fromCharCode(r)})}function p(n,r){return r.browser||"undefined"==typeof Buffer?f(n).split("").map(function(n){return n.charCodeAt()}):new Buffer(n,r.encoding)}function g(n){var r=k.array("uint8",n);return new k({unpack:function(n,e,t){var a=k.unpack(r,n,e,t);return e.browser||"undefined"==typeof Buffer?s(String.fromCharCode.apply(String,a)):new Buffer(a).toString(e.encoding)},pack:function(n,e,t){k.pack(r,p(n,e),e,t)},namespace:"string",args:arguments})}function y(n){return new k({unpack:function(r,e,t){var a;a=null===n?new Uint8Array(r,t[0]):k.unpack(k.bytes(n),r,e,t);for(var i=0;a[i];)i++;var u=k.unpack(k.string(i),a,e);return null===n&&(t[0]+=i+1),u},pack:function(r,e,t){var a=[0];[].unshift.apply(a,k.stringBytes(r,e)),k.pack(k.bytes(n),a,e,t)},namespace:"cstring",args:arguments})}function l(n,r){for(var e=0;e<n.length;e++)if(n[e][0]===r)return n[e][1]}function m(n,r){return new k({unpack:function(e,t,a){if(!t.$scope)throw new Error("Unpack must running in object.");var i=t.$scope[n];if("undefined"==typeof i)throw new Error('Field "'+n+'" is undefined.');return k.unpack(r(i),e,t,a)},pack:function(e,t,a){var i=t.$scope[n];if("undefined"==typeof i)throw new Error('Field "'+n+'" is undefined.');k.pack(r(i),e,t,a)},namespace:"depend",args:arguments})}function v(n,r){return U(n,k.array(r))}function h(n,r,e,t){var a=k.bytes(t);return new k({unpack:function(n,t,i){var u=r(k.unpack(a,n,t,i));return k.unpack(e,u,t)},pack:function(r,t,i){var u=n(k.pack(e,r,t));k.pack(a,u,t,i)},namespace:"parse",args:arguments})}function d(n,r){return new k({unpack:function(){return/string|number/.test(typeof n)?n+r:"function"==typeof n?n(r):r},pack:function(){},args:arguments,namespace:"virtual"})}var k=r(),w={int8:{type:"Int8",size:1,alias:["shortint"],array:Int8Array},uint8:{type:"Uint8",size:1,alias:["byte"],array:Uint8Array},int16:{type:"Int16",size:2,alias:["smallint"],array:Int16Array},uint16:{type:"Uint16",size:2,alias:["word"],array:Uint16Array},int32:{type:"Int32",size:4,alias:["longint"],array:Int32Array},uint32:{type:"Uint32",size:4,alias:["longword"],array:Uint32Array},float32:{type:"Float32",size:4,alias:["single"],array:Float32Array},float64:{type:"Float64",size:8,alias:["double"],array:Float64Array}};Object.keys(w).forEach(function(n){var r=w[n],e=new k({unpack:function(n){return function(e,t,a){var i=a[0];a[0]+=r.size;var u;return u=e instanceof DataView?e:new DataView(e),u[n](i,t.littleEndian)}}("get"+r.type),pack:function(n){return function(e,t,a){var i=new ArrayBuffer(r.size),u=new DataView(i),o=new Uint8Array(i);u[n](0,e,t.littleEndian),[].push.apply(a,o)}}("set"+r.type),size:r.size,name:n,namespace:"number",array:r.array});k.register(n,e),(r.alias||[]).forEach(function(n){k.register(n,e)})});var b=k.together(n,function(n,r){n.namespace="array",n.args=r});k.register("array",b),k.register("shortArray",e),k.register("smallArray",t),k.register("longArray",a),k.register("bytes",i);var A=k.together(u,function(n,r){n.namespace="object",n.args=r});k.register("object",A),k.pushPattern(function(n){if("object"==typeof n){if(n instanceof k)return;if(n instanceof Array)return;return A(n)}});var E=k.together(o,function(n,r){n.namespace="union",n.args=r});k.register("union",E);var z=k.together(c,function(n,r){n.namespace="enums",n.args=r});k.register("enums",z),k.stringBytes=p;var C=k.together(g,function(n,r){n.namespace="string",n.args=r});k.register("string",C),k.register("shortString",C("uint8")),k.register("smallString",C("uint16")),k.register("longString",C("uint32"));var j=k.together(y,function(n,r){n.namespace="cstring",n.args=r});k.register("cstring",j),k.register("pchar",j(null));var S=k.together(l,function(n,r){n.namespace="cases",n.args=r});k.register("cases",S);var U=k.together(m,function(n,r){n.namespace="depend",n.args=r});k.register("depend",U),k.register("dependArray",v);var B=k.together(h,function(n,r){n.namespace="parse",n.args=r});k.register("parse",B);var O=k.together(d,function(n,r){n.namespace="virtual",n.args=r});return k.register("virtual",O),k}var t=e();t.create=e;var a=t;"function"==typeof define?(define.amd||define.cmd)&&define(function(){return a}):"undefined"!=typeof module&&module.exports?module.exports=a:window[n]=a}("jpacks");