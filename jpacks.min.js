!function(r){function n(){function r(r){var n=this;Object.keys(r).forEach(function(e){n[e]=r[e]})}function n(r){r=r||{},Object.keys(r).forEach(function(n){f[n]=r[n]})}function e(r){if(r instanceof ArrayBuffer)return r;var n=new ArrayBuffer(r.length),e=new Uint8Array(n,0,r.length);return e.set(r),n}function t(n,t,a,i){var u=r.from(n);if(!u)throw new Error('Parameter schema "'+n+'" is unregister.');return t=e(t),a=a||{},i=i||[0],Object.keys(f).forEach(function(r){"undefined"==typeof a[r]&&(a[r]=f[r])}),u.unpack(t,a,i)}function a(n,e,t,a){var i=r.from(n);if(!i)throw new Error('Parameter schema "'+n+'" is unregister.');return a=a||[],t=t||{},Object.keys(f).forEach(function(r){"undefined"==typeof t[r]&&(t[r]=f[r])}),i.pack(e,t,a),a}function i(r,n,e){if(r.length<=0)return r;var t=function(){var t=[];if([].push.apply(t,e),[].push.apply(t,arguments),t.length>=r.length)return r.apply(null,t);var a=i(r,n,t);return"function"==typeof n&&n(a,t),a};return t}function u(n){function e(n){if(!n)return n;if(n.namespace)return"number"===n.namespace?n.name:n.args?n.namespace+"("+u.apply(null,n.args)+")":n.namespace;if(n.name)return n.name;if("function"==typeof n)return n.name="_pack_fn"+s++,r.define(n.name,n),n.name;if("object"==typeof n){var t=new n.constructor;return Object.keys(n).forEach(function(r){t[r]=e(n[r])}),t}return n}if(arguments.length>1){for(var t=[],a=0;a<arguments.length;a++)t.push(u(arguments[a]));return t.join()}return JSON.stringify(e(n)||"").replace(/"/g,"")}var c={};r.register=function(n,e){c[n]=e,r[n]||(r[n]=e)},r.def=r.register;var o=[function(r){for(var n={},e=r;"string"==typeof e;){if(n[e])return;e=c[e],n[e]=!0}return e}];r.pushPattern=function(r){o.push(r)},r.from=function(n){if(n instanceof r)return n;for(var e=-1,t=0;t<o.length;t++)if(e!==t){var a=o[t](n);if(a){if(a instanceof r)return a;n=a,e=t,t=0}}};var f={littleEndian:!0};r.setDefaultOptions=n,r.arrayBufferFrom=e,r.unpack=t,r.pack=a,r.together=i;var s=0;return r.stringify=u,r.prototype.toString=function(){return u(this)},r}function e(){function r(r,n){var e,t;return"number"==typeof n?e=r.size*n:t=d.from(n),new d({unpack:function(a,i,u){var c=n;if(t&&(c=d.unpack(t,a,i,u)),r.array&&i.littleEndian){e=t.size*c;var o=u[0];return u[0]+=e,[].slice.apply(new r.array(a,o,c))}for(var f=[],s=0;c>s;s++)f.push(d.unpack(r,a,i,u));return f},pack:function(a,i,u){var c=n;if(t&&(c=a?a.length:0,d.pack(t,c,i,u)),r.array&&i.littleEndian){e=r.size*c;var o=new ArrayBuffer(e),f=new r.array(o);f.set(a);var s=new Uint8Array(o);[].push.apply(u,s)}for(var p=0;c>p;p++)d.pack(r,(a||[])[p],i,u)},namespace:"array",args:arguments,size:e})}function e(r){return w(r,"uint8")}function t(r){return w(r,"uint16")}function a(r){return w(r,"uint32")}function i(r){return d.array("uint8",r)}function u(r){if(r instanceof d)return r;var n=Object.keys(r);return new d({unpack:function(e,t,a){var i=new r.constructor,u=t.$scope;return t.$scope=i,n.forEach(function(n){i[n]=d.unpack(r[n],e,t,a)}),t.$scope=u,i},pack:function(e,t,a){var i=t.$scope;t.$scope=e,n.forEach(function(n){d.pack(r[n],e[n],t,a)}),t.$scope=i},args:arguments,namespace:"object"})}function c(r,n){var e=Object.keys(r);return new d({unpack:function(t,a,i){var u=i[0],c={};return e.forEach(function(n){i[0]=u,c[n]=d.unpack(r[n],t,a,i)}),i[0]+=n,c},pack:function(t,a,i){var u=new ArrayBuffer(n),c=new Uint8Array(u);e.forEach(function(n){if("undefined"!=typeof t[n]){var e=[];d.pack(r[n],t[n],a,e),c.set(e)}}),[].push.apply(i,c)},size:n,args:arguments,namespace:"union"})}function o(r,n){if(n=d.from(n),r instanceof Array){var e={};r.forEach(function(r,n){e[r]=n}),r=e}var t=Object.keys(r);return new d({unpack:function(e,a,i){var u,c=d.unpack(n,e,a,i);return t.every(function(n){return r[n]===c?(u=n,!1):!0}),u||c},pack:function(e,a,i){if("number"==typeof e)return void d.pack(n,e,a,i);if(t.every(function(t){return t===e?(d.pack(n,r[t],a,i),!1):!0}))throw new Error('Not find enum "'+e+'".')},namespace:"enums",args:arguments})}function f(r){return String(r).replace(/[\u0080-\u07ff]/g,function(r){var n=r.charCodeAt(0);return String.fromCharCode(192|n>>6,128|63&n)}).replace(/[\u0800-\uffff]/g,function(r){var n=r.charCodeAt(0);return String.fromCharCode(224|n>>12,128|n>>6&63,128|63&n)})}function s(r){return String(r).replace(/[\u00c0-\u00df][\u0080-\u00bf]/g,function(r){var n=(31&r.charCodeAt(0))<<6|63&r.charCodeAt(1);return String.fromCharCode(n)}).replace(/[\u00e0-\u00ef][\u0080-\u00bf][\u0080-\u00bf]/g,function(r){var n=(15&r.charCodeAt(0))<<12|(63&r.charCodeAt(1))<<6|63&r.charCodeAt(2);return String.fromCharCode(n)})}function p(r,n){return n.browser||"undefined"==typeof Buffer?f(r).split("").map(function(r){return r.charCodeAt()}):new Buffer(r,n.encoding)}function g(r){var n=d.array("uint8",r);return new d({unpack:function(r,e,t){var a=d.unpack(n,r,e,t);return e.browser||"undefined"==typeof Buffer?s(String.fromCharCode.apply(String,a)):new Buffer(a).toString(e.encoding)},pack:function(r,e,t){d.pack(n,p(r,e),e,t)},namespace:"string",args:arguments})}function y(r){return new d({unpack:function(n,e,t){var a;a=r===!0?new Uint8Array(n,t[0]):d.unpack(d.bytes(r),n,e,t);for(var i=0;a[i];)i++;var u=d.unpack(d.string(i),a,e);return r===!0&&(t[0]+=i+1),u},pack:function(n,e,t){var a=[0];[].unshift.apply(a,d.stringBytes(n,e)),r===!0?d.pack(d.bytes(a.length),a,e,t):d.pack(d.bytes(r),a,e,t)},namespace:"cstring",args:arguments})}function l(r,n){for(var e=0;e<r.length;e++)if(r[e][0]===n)return r[e][1]}function m(r,n){return new d({unpack:function(e,t,a){if(!t.$scope)throw new Error("Unpack must running in object.");var i=t.$scope[r];if("undefined"==typeof i)throw new Error('Field "'+r+'" is undefined.');return d.unpack(n(i),e,t,a)},pack:function(e,t,a){var i=t.$scope[r];if("undefined"==typeof i)throw new Error('Field "'+r+'" is undefined.');d.pack(n(i),e,t,a)},namespace:"depend",args:arguments})}function h(r,n){return S(r,d.array(n))}function v(r,n,e,t){var a=d.bytes(t);return new d({unpack:function(r,t,i){var u=n(d.unpack(a,r,t,i));return d.unpack(e,u,t)},pack:function(n,t,i){var u=r(d.pack(e,n,t));d.pack(a,u,t,i)},namespace:"parse",args:arguments})}var d=n(),k={int8:{type:"Int8",size:1,alias:["shortint"],array:Int8Array},uint8:{type:"Uint8",size:1,alias:["byte"],array:Uint8Array},int16:{type:"Int16",size:2,alias:["smallint"],array:Int16Array},uint16:{type:"Uint16",size:2,alias:["word"],array:Uint16Array},int32:{type:"Int32",size:4,alias:["longint"],array:Int32Array},uint32:{type:"Uint32",size:4,alias:["longword"],array:Uint32Array},float32:{type:"Float32",size:4,alias:["single"],array:Float32Array},float64:{type:"Float64",size:8,alias:["double"],array:Float64Array}};Object.keys(k).forEach(function(r){var n=k[r],e=new d({unpack:function(r){return function(e,t,a){var i=a[0];a[0]+=n.size;var u;return u=e instanceof DataView?e:new DataView(e),u[r](i,t.littleEndian)}}("get"+n.type),pack:function(r){return function(e,t,a){var i=new ArrayBuffer(n.size),u=new DataView(i),c=new Uint8Array(i);u[r](0,e,t.littleEndian),[].push.apply(a,c)}}("set"+n.type),size:n.size,name:r,namespace:"number",array:n.array});d.register(r,e),(n.alias||[]).forEach(function(r){d.register(r,e)})});var w=d.together(r,function(r,n){r.namespace="array",r.args=n});d.register("array",w),d.register("shortArray",e),d.register("smallArray",t),d.register("longArray",a),d.register("bytes",i);var A=d.together(u,function(r,n){r.namespace="object",r.args=n});d.register("object",A),d.pushPattern(function(r){if("object"==typeof r){if(r instanceof d)return;if(r instanceof Array)return;return A(r)}});var b=d.together(c,function(r,n){r.namespace="union",r.args=n});d.register("union",b);var E=d.together(o,function(r,n){r.namespace="enums",r.args=n});d.register("enums",E),d.stringBytes=p;var C=d.together(g,function(r,n){r.namespace="string",r.args=n});d.register("string",C),d.register("shortString",C("uint8")),d.register("smallString",C("uint16")),d.register("longString",C("uint32"));var j=d.together(y,function(r,n){r.namespace="cstring",r.args=n});d.register("cstring",j),d.register("pchar",j(!0));var z=d.together(l,function(r,n){r.namespace="cases",r.args=n});d.register("cases",z);var S=d.together(m,function(r,n){r.namespace="depend",r.args=n});d.register("depend",S),d.register("dependArray",h);var B=d.together(v,function(r,n){r.namespace="parse",r.args=n});return d.register("parse",B),d}var t=e();t.create=e;var a=t;"function"==typeof define?(define.amd||define.cmd)&&define(function(){return a}):"undefined"!=typeof module&&module.exports?module.exports=a:window[r]=a}("jpacks");